<template>
  <div class="fx-table" :class="classes" :style="style">
    <!-- 头部 -->
    <div
      class="fx-table--header"
      :class="cOptions.headerProps.classes"
      v-if="cOptions.header"
      :style="headerStyle"
    >
      <slot name="header"></slot>
    </div>

    <!-- 中部 -->
    <div class="fx-table--body" :style="bodyStyle">
      <!-- 侧边栏 -->
      <template>
        <FxAside
          v-if="cOptions.aside"
          :opened.sync="showAside"
          :style="asideStyle"
          :showToggle="cOptions.asideProps.showToggle"
          position="left"
        >
          <slot name="aside"></slot>
        </FxAside>

        <FxAside
          v-if="cOptions.asideRight"
          :opened.sync="showAsideRight"
          :style="asideRightStyle"
          :showToggle="cOptions.asideRightProps.showToggle"
          position="right"
        >
          <slot name="asideRight"></slot>
        </FxAside>

        <FxAside
          v-if="cOptions.asideBottom"
          :opened.sync="showAsideBottom"
          :style="asideBottomStyle"
          :showToggle="cOptions.asideBottomProps.showToggle"
          position="bottom"
        >
          <slot name="asideBottom"></slot>
        </FxAside>

        <FxAside
          v-if="cOptions.asideTop"
          :opened.sync="showAsideTop"
          :style="asideTopStyle"
          :showToggle="cOptions.asideTopProps.showToggle"
          position="top"
        >
          <slot name="asideBottom"></slot>
        </FxAside>
      </template>

      <!-- 抽屉 -->
      <el-drawer
        v-if="cOptions.drawer && $slots.drawer"
        :title="drawer.title"
        :visible.sync="drawer.visible"
        :direction="drawer.direction"
        :modal="false"
        :size="drawer.size"
      >
        <slot name="drawer" />
      </el-drawer>

      <div class="fx-table--main" :style="mainStyle">
        <!-- 工具栏 -->
        <div
          class="fx-table--toolbar"
          v-if="cOptions.toolbar"
          :style="toolbarStyle"
        >
          <slot name="toolbar">
            <DefaultToolbar v-bind="cOptions.toolbarProps" />
          </slot>
        </div>

        <!-- 搜索栏 -->
        <div
          ref="fxTableSearchbar"
          class="fx-table--searchbar"
          v-if="cOptions.searchbar && $slots.superQuery"
          v-show="searchbarVisible"
          :style="searchbarStyle"
        >
          <slot name="searchbar">
            <DefaultSearchbar v-model="searchModel" @submit="onSearchbarSubmit">
              <slot name="superQuery"></slot>
            </DefaultSearchbar>
          </slot>
        </div>

        <!-- 主体部分 -->
        <div
          class="fx-table--table"
          v-if="ready"
          v-loading="vLoading"
          :style="tableStyle"
        >
          <el-table
            ref="table"
            :data="tableData"
            height="100%"
            :size="cOptions.size"
            :border="cOptions.border"
            :row-key="cOptions.rowKey"
            :stripe="cOptions.stripe"
            :tree-props="
              cOptions.tree
                ? cOptions.treeProps
                : { children: '', hasChildren: '' }
            "
            :lazy="cOptions.treeProps.lazy"
            :load="cOptions.treeProps.load"
            :default-sort="defaultSort"
            :highlight-current-row="highlightCurrentRow"
            :show-summary="cOptions.showSummary"
            :summary-method="cOptions.summaryMethod"
            :row-class-name="rowClassName"
            @sort-change="onSortChange"
            @row-click="onRowClick"
            @row-dblclick="onRowDblclick"
            @row-contextmenu="onRowContextmenu"
            @selection-change="onSelectionChange"
            @current-change="onCurrentChange"
          >
            <!-- 选项框列 -->
            <el-table-column
              type="selection"
              align="center"
              width="50px"
              fixed
              v-if="cOptions.selectable && cOptions.singleSelect == false"
            ></el-table-column>

            <!-- 索引列 -->
            <el-table-column
              width="50px"
              :label="cOptions.indexTitle"
              :formatter="indexFormatter"
              align="center"
              fixed
              v-if="cOptions.showIndex"
            ></el-table-column>

            <!--用户提供的列-->
            <slot>
              <FxTableColumn
                v-for="(c, index) in visibleColumns"
                :column="c"
                :key="(c.prop || '') + index"
                :render="slotsRender"
                :currentRow="currentRow"
              ></FxTableColumn>
            </slot>
          </el-table>
        </div>

        <!-- 分页控件 -->
        <div
          class="fx-table--pagination"
          v-if="cOptions.pagination"
          :style="paginationStyle"
        >
          <FxPager
            v-model="pagerModel"
            :config.sync="pagerConfig"
            @current-change="onPagerCurrentChange"
            @size-change="onPagerSizeChange"
          />
        </div>
      </div>
    </div>

    <!-- 尾部 -->
    <div class="fx-table--footer" v-if="cOptions.footer" :style="footerStyle">
      <slot name="footer"></slot>
    </div>
  </div>
</template>

<script>
import Vue from "vue";
import FxTableColumn from "./components/FxTableColumn.vue";
import FxSearchbar from "./components/FxSearchbar.vue";
import FxPager from "./components/FxPager.vue";
import FxButton from "./components/FxButton.vue";
import FxAside from "./components/FxAside.vue";
import { DEFAULT_OPTIONS } from "./config";
import {
  getCalcPagerSizes,
  getCssNumber,
  firstToUpper,
  genColumns,
  decorateData,
  decorateRow,
  isNotEmpty,
} from "./utils";
import axios from "axios";
import merge from "merge";
import ActionRenderer from "./components/ActionRenderer.vue";
import ColumnToggle from "./components/ColumnToggle.vue";
import DefaultToolbar from "./components/DefaultToolbar";
import DefaultSearchbar from "./components/DefaultSearchbar";

export default {
  name: "FxTable",

  components: {
    FxTableColumn,
    FxPager,
    FxSearchbar,
    FxButton,
    FxAside,
    ActionRenderer,
    ColumnToggle,
    DefaultToolbar,
    DefaultSearchbar,
  },

  data() {
    const {
      pageNumber,
      pageSize,
      pagerLayout,
      pagerSizes,
      sort,
      order,
      aside,
      asideProps,
      asideRight,
      asideRightProps,
      asideBottom,
      asideBottomProps,
      asideTop,
      asideTopProps,
      fullScreen,
      presetRowStates,
      searchbarProps,
    } = merge.recursive(
      true,
      {},
      DEFAULT_OPTIONS,
      Vue.__FxTable_defaultOptions,
      this.options
    );

    const tableData = this.decorateData(this.data, {
      ...Vue.__FxTable_presetRowStates,
      ...presetRowStates,
    });
    // const tableData = this.data;

    this.$emit("update:data", tableData);

    return {
      ready: false,

      fullScreen: fullScreen,

      showAside: asideProps.show,

      showAsideRight: asideRightProps.show,

      showAsideBottom: asideBottomProps.show,

      showAsideTop: asideTopProps.show,

      // superSearch: false,

      searchbarVisible: searchbarProps.show,

      searchbarSize: searchbarProps.size,

      tableData: tableData,

      vColumns: genColumns(this.columns),

      pagerModel: {
        pageIndex: pageNumber,
        pageSize: pageSize,
      },

      searchModel: this.query,

      sortModel: {
        order: order,
        sort: sort,
      },

      defaultSort: {
        prop: sort,
        order:
          order === "asc" ? "ascending" : order === "desc" ? "descending" : "",
      },

      pagerConfig: {
        layout: pagerLayout,
        total: 0,
        pageSize: pageSize,
        sizes: getCalcPagerSizes(pageSize, pagerSizes),
      },

      vLoading: this.loading,

      selected: {
        rows: [],
        row: null,
      },

      //当前行
      currentRow: null,
    };
  },

  props: {
    columns: {},

    options: {},

    data: {
      type: Array,
      default: () => [],
    },

    loading: Boolean,

    query: {},

    // actions: Array,
  },

  provide() {
    return {
      $fxTable: this,

      // toggleSearchbarVisible: this.toggleSearchbarVisible,

      // refreshTable: this.refreshTable,

      // cOptions: this.cOptions,

      // searchModel: this.searchModel,

      // vColumns: this.vColumns,
    };
  },

  watch: {
    data: {
      handler(val) {
        this.tableData = val;
      },
      deep: true,
    },

    tableData: {
      handler(val) {
        this.$emit("update:data", val);
      },
      deep: true,
    },

    columns: {
      handler(val) {
        this.vColumns = genColumns(val);
      },
      deep: true,
    },

    query: {
      handler(val) {
        this.searchModel = val;
      },
      deep: true,
    },

    searchModel: {
      handler(val) {
        this.$emit("update:query", val);
      },
      deep: true,
    },

    //监听api变更
    "cOptions.api"(newApi) {
      this.refreshTable();
    },

    loading(val) {
      this.vLoading = val;
    },
    vLoading(val) {
      this.$emit("update:loading", val);
    },
  },

  computed: {
    table() {
      return this.$refs.table;
    },

    // cActions() {
    //   return this.actions;
    // },

    visibleColumns() {
      return this.vColumns.filter((c) => c.visible);
    },

    cPresetRowStates() {
      return {
        ...Vue.__FxTable_presetRowStates,
        ...this.cOptions.presetRowStates,
      };
    },

    selectedRows: {
      get() {
        const { selectable, singleSelect } = this.cOptions;
        if (selectable) {
          if (singleSelect) {
            return this.selected.row ? [this.selected.row] : [];
          } else {
            return this.selected.rows;
          }
        } else {
          return [];
        }
      },
      set(data) {
        const { selectable, singleSelect } = this.cOptions;
        if (selectable) {
          if (singleSelect) {
            this.selected.row = data;
          } else {
            this.selected.rows = data;
          }
        }
      },
    },

    // selectedRow: {
    //   get() {
    //     const { selectable, singleSelect } = this.cOptions;
    //     if (selectable || singleSelect) {
    //       return this.selected.row;
    //     } else {
    //       return null;
    //     }
    //   },
    //   set(row) {
    //     const { selectable, singleSelect } = this.cOptions;
    //     if (selectable || singleSelect) {
    //       this.selected.row = data;
    //     }
    //   },
    // },

    highlightCurrentRow() {
      const { selectable, singleSelect, highlightCurrentRow } = this.cOptions;

      // return (selectable && singleSelect) || highlightCurrentRow;
      return highlightCurrentRow;
    },

    cOptions: {
      get() {
        return merge.recursive(
          true,
          true,
          {},
          DEFAULT_OPTIONS,
          Vue.__FxTable_defaultOptions,
          this.options
        );
      },
    },

    classes() {
      const classes = [];

      if (this.showAside) {
        classes.push("is--show-aside");
      }

      if (this.fullScreen) {
        classes.push("is--full-screen");
      }

      if (this.cOptions.outBorder) {
        classes.push("is--out-border");
      }

      if (this.data.length >= 50) {
        classes.push("is--no-transition");
      }

      if (this.cOptions.toolbar) {
        classes.push("is--has-toolbar");
      }

      if (this.cOptions.pagination) {
        classes.push("is--has-pagination");
      }

      return classes;
    },

    style() {
      const { height, width, background } = this.cOptions;
      return {
        height: getCssNumber(height),
        width: getCssNumber(width),
        background,
      };
    },

    headerStyle() {
      const { headerProps } = this.cOptions;
      const { height, background } = headerProps;

      return {
        height: getCssNumber(height),
        background,
      };
    },

    bodyStyle() {
      const { header, headerProps, footer, footerProps } = this.cOptions;

      return {
        height: `calc(100% 
        ${header ? "- " + getCssNumber(headerProps.height) : ""} 
        ${footer ? "- " + getCssNumber(footerProps.height) : ""} 
        )`,
      };
    },

    asideStyle() {
      const { width, background, bottom, top } = this.cOptions.asideProps;
      return {
        width: this.showAside ? getCssNumber(width) : 0,
        background: background,
        top: getCssNumber(top),
        bottom: getCssNumber(bottom),
      };
    },

    asideRightStyle() {
      const { width, background, bottom, top } = this.cOptions.asideRightProps;
      return {
        width: this.showAsideRight ? getCssNumber(width) : 0,
        background: background,
        top: getCssNumber(top),
        bottom: getCssNumber(bottom),
      };
    },

    asideBottomStyle() {
      const { height, background } = this.cOptions.asideBottomProps;

      return {
        height: this.showAsideBottom ? getCssNumber(height) : 0,
        background: background,
        left: this.getAsideShowByPosition("left")
          ? getCssNumber(this.cOptions.asideProps.width)
          : 0,
        right: this.getAsideShowByPosition("right")
          ? getCssNumber(this.cOptions.asideRightProps.width)
          : 0,
      };
    },

    asideTopStyle() {
      const { height, background } = this.cOptions.asideTopProps;

      return {
        height: this.showAsideTop ? getCssNumber(height) : 0,
        background: background,
        left: this.getAsideShowByPosition("left")
          ? getCssNumber(this.cOptions.asideProps.width)
          : 0,
        right: this.getAsideShowByPosition("right")
          ? getCssNumber(this.cOptions.asideRightProps.width)
          : 0,
      };
    },

    mainStyle() {
      const {
        aside,
        asideProps,
        asideRight,
        asideRightProps,
        asideBottom,
        asideBottomProps,
        asideTop,
        asideTopProps,
      } = this.cOptions;
      return {
        left: aside && this.showAside ? getCssNumber(asideProps.width) : 0,
        right:
          asideRight && this.showAsideRight
            ? getCssNumber(asideRightProps.width)
            : 0,
        bottom:
          asideBottom && this.showAsideBottom
            ? getCssNumber(asideBottomProps.height)
            : 0,
        top:
          asideTop && this.showAsideTop
            ? getCssNumber(asideTopProps.height)
            : 0,
      };
    },

    toolbarStyle() {
      const { toolbarProps } = this.cOptions;
      const { height } = toolbarProps;

      return {
        height: getCssNumber(height),
      };
    },

    searchbarStyle() {
      const { searchbarProps } = this.cOptions;
      const { minHeight, maxHeight, background } = searchbarProps;

      return {
        height:
          this.searchbarSize === "mini"
            ? getCssNumber(minHeight)
            : this.searchbarSize === "max"
            ? getCssNumber(maxHeight)
            : "auto",
        background,
      };
    },

    tableStyle() {
      const {
        toolbar,
        toolbarProps,
        searchbar,
        searchbarProps,
        pagination,
        paginationProps,
      } = this.cOptions;

      //工具栏高度
      const toolbarHeight = toolbar ? getCssNumber(toolbarProps.height) : "0px";

      //搜索栏高度
      const searchbarHeight =
        searchbar && this.searchbarVisible
          ? getCssNumber(
              this.searchbarSize === "mini"
                ? searchbarProps.minHeight
                : this.searchbarSize === "max"
                ? searchbarProps.maxHeight
                : 0
            )
          : "0px";

      // console.log(this.$refs.fxTableSearchbar.clientHeight);

      //分页栏高度
      const paginationHeight = pagination
        ? getCssNumber(paginationProps.height)
        : "0px";

      return {
        height: `calc(100% - ${toolbarHeight} - ${searchbarHeight} - ${paginationHeight})`,
      };
    },

    paginationStyle() {
      const { paginationProps } = this.cOptions;
      const { height } = paginationProps;

      return {
        height: getCssNumber(height),
      };
    },

    footerStyle() {
      const { footerProps } = this.cOptions;
      const { height, background } = footerProps;

      return {
        height: getCssNumber(height),
        background,
      };
    },

    queryParams() {
      const model = {
        ...this.pagerModel,
        ...this.sortModel,
        ...this.searchModel,
      };

      if (this.request || this.method.toLowerCase() !== "get") {
        return model;
      } else {
        return {
          params: model,
        };
      }

      // return this.method.toLowerCase() === "get"
      //   ? {
      //       params: model,
      //     }
      //   : model;
    },

    method() {
      return this.cOptions.method;
    },

    api() {
      return this.cOptions.api;
    },

    request() {
      return this.cOptions.request;
    },

    needRequest() {
      return (
        this.cOptions.api ||
        (this.cOptions.request && typeof this.cOptions.request === "function")
      );
    },

    rowKey() {
      return this.cOptions.rowKey;
    },
  },

  methods: {
    //表格索引生成函数
    indexFormatter(row, column, value, index) {
      const { pageIndex, pageSize } = this.pagerModel;

      if (this.cOptions.pagination) {
        if (!this.cOptions.indexFormatter) {
          return (pageIndex - 1) * pageSize + index + 1;
        } else {
          return this.cOptions.indexFormatter({
            pageIndex,
            pageSize,
            value,
            row,
            column,
            index,
          });
        }
      } else {
        return index + 1;
      }
    },

    //切换搜索栏大小
    toggleSearchbarSize(size) {
      if (size) {
        return (this.searchbarSize = size);
      }

      this.searchbarSize === "mini"
        ? (this.searchbarSize = "max")
        : (this.searchbarSize = "mini");
    },

    //切换搜索栏显示隐藏
    toggleSearchbarVisible(bl = null) {
      const val = bl !== null ? bl : !this.searchbarVisible;

      this.searchbarVisible = !this.searchbarVisible;
    },

    //切换全屏显示
    toggleFullScreen() {
      this.fullScreen = !this.fullScreen;
    },

    //根据位置获取边栏是否存在且处于打开状态
    getAsideShowByPosition(position) {
      position = firstToUpper(position);
      if (position === "Left") position = "";
      return this.cOptions["aside" + position] && this["showAside" + position];
    },

    //用户改变了搜索条件
    onInputChangedByUser() {
      this.refreshTable();
    },

    //用户点击高级搜索确认
    onSearchbarSubmit() {
      this.refreshTable();
    },

    //搜索按钮点击
    onSearchBtnClick() {
      this.refreshTable();
    },

    //翻页组件页码变更
    onPagerCurrentChange() {
      this.refreshTable(false);
    },

    //翻页组件每页数量变更
    onPagerSizeChange(val) {
      this.refreshTable();
    },

    //排序变更
    onSortChange({ column, prop, order }) {
      if (order) {
        this.sortModel.sort = prop || "";
        this.sortModel.order = order.replace("ending", "");
      } else {
        this.sortModel.sort = "";
        this.sortModel.order = this.cOptions.order;
      }
      this.refreshTable();
    },

    //多选，选择项变更
    onSelectionChange(selection) {
      this.selectedRows = selection;
    },

    //当前项变更
    onCurrentChange(currentRow, oldCurrentRow) {
      // if()
      const { selectable, singleSelect } = this.cOptions;
      if (!selectable || !singleSelect) return;

      this.selectedRows = currentRow;
      this.currentRow = currentRow;
    },

    //当某一行被点击时会触发该事件
    onRowClick(row, column, event) {
      const { selectable, singleSelect, clickToSelect } = this.cOptions;

      if (selectable && !singleSelect && clickToSelect) {
        this.toggleRowSelection(row);
      }

      this.$emit("row-click", ...arguments);
    },

    //当某一行被双击时会触发该事件
    onRowDblclick(row, column, event) {
      this.$emit("row-dblclick", ...arguments);
    },

    //当某一行被鼠标右键点击时会触发该事件
    onRowContextmenu(row, column, event) {
      this.$emit("row-contextmenu", ...arguments);
    },

    //获取数据
    async getData() {
      if (!this.needRequest) return;
      // if (!this.api && !this.request) return;

      this.vLoading = true;

      try {
        let data = null;

        //根据api路径发起请求
        if (this.api) {
          const response = await (Vue.__FxTable_axios || axios)[
            this.method.toLowerCase()
          ](this.cOptions.api, this.queryParams);

          data = response.data;
        }
        //根据request方法发起请求
        else if (this.request) {
          const response = await this.request(this.queryParams);

          data = response.data;
        }

        if (!data) throw new Error("data不存在");

        const res = this.cOptions.resHandler.call(this, data);

        if (this.cOptions.pagination) {
          const { rows, total } = res;
          this.tableData = this.decorateData(rows);
          this.pagerConfig.total = total;
        } else {
          this.tableData = this.decorateData(res);
        }
        this.vLoading = false;
      } catch (error) {
        // if (process.env === "development") {
        console.warn(`[FxTable]组件getData方法错误：`, error);
        // }
        this.vLoading = false;
      }
    },

    /**
     *刷新表格数据
     * @param {boolean} resetPageNumber 是否重置页码
     */
    refreshTable(resetPageNumber = true) {
      if (resetPageNumber) {
        this.pagerModel.pageIndex = this.cOptions.pageNumber;
        // this.pagerModel.pageSize = this.cOptions.pageSize;
        this.$nextTick((_) => {
          this.getData();
        });
      } else {
        this.getData();
      }
    },

    /**
     * 刷新
     */
    refresh(resetPageNumber) {
      this.refreshTable(resetPageNumber);
    },

    //获取选中项
    getSelected() {
      return this.selectedRows;
    },

    //用于多选表格，清空用户的选择
    clearSelection() {
      this.table.clearSelection();
    },

    //用于多选表格，切换某一行的选中状态
    toggleRowSelection(row, selected) {
      this.table.toggleRowSelection(row, selected);
    },

    //用于多选表格，切换所有行的选中状态
    toggleAllSelection() {
      this.table.toggleAllSelection();
    },

    //用于可展开表格与树形表格，切换某一行的展开状态
    toggleRowExpansion(row, expanded) {
      this.table.toggleRowExpansion(row, expanded);
    },

    //用于单选表格，设定某一行为选中行,如果调用时不加参数，则会取消目前高亮行的选中状态
    setCurrentRow(row) {
      this.table.setCurrentRow(row);
    },

    //清空过滤条件,也可传入由columnKey组成的数组以清除指定列的过滤条件
    clearFilter(columnKey) {
      this.table.clearFilter(columnKey);
    },

    //对 Table 进行重新布局
    doLayout() {
      this.table.doLayout();
    },

    /**
     * 切换aside显示
     * @param {string} position aside方向 (可选) 不填则切换所有aside的状态
     * @param {boolean} bl 显示或隐藏 (可选)
     */
    toggleAside(position, bl) {
      let positionArr = ["", "Right", "Top", "Bottom"];
      // 0 arguments
      if (arguments.length === 0) {
        positionArr.forEach((p) => {
          this["showAside" + p] = !this["showAside" + p];
        });
      }
      // 1 arguments
      else if (arguments.length === 1) {
        let [arg1] = arguments;

        arg1 = firstToUpper(arg1);
        arg1 = arg1 === "Left" ? "" : arg1;

        if (typeof arg1 === "string") {
          this["showAside" + arg1] = !this["showAside" + arg1];
        } else if (typeof arg1 === "boolean") {
          positionArr.forEach((p) => {
            this["showAside" + p] = arg1;
          });
        }
      }
      // >1 arguments
      else if (arguments.length > 1) {
        let [arg1, arg2] = arguments;
        arg1 = firstToUpper(arg1);
        arg1 = arg1 === "Left" ? "" : arg1;

        this["showAside" + arg1] = arg2;
      }
    },

    /**
     * 执行Action操作
     * @param {Action} action Action对象
     */
    runAction(action) {
      const { callback, thisArg } = action;

      //如果用户未定义thisArg,则默认在当前table上下文中调用action
      callback && callback.call(thisArg || this);
    },

    //插入行
    insertRow(row, index) {
      const _row = this.decorateRow(row);

      if (typeof index !== "number") {
        this.tableData.push(_row);
      } else {
        this.tableData.splice(index, 0, _row);
      }
    },

    /**
     *删除行
     */
    removeRow(row) {
      if (!row) return;

      this.removeRowByIndex(this.tableData.indexOf(row));
    },

    removeRowByKey(id) {
      const row = this.getRowByKey(id);

      this.removeRow(row);
    },

    removeRowByIndex(index) {
      if (index < 0) return;

      this.tableData.splice(index, 1);
    },

    /**
     * 通过唯一id获取行数据
     */
    getRowByKey(id) {
      return this.tableData.find((i) => i[this.rowKey] === id);
    },

    //fx-table-column的作用域插槽渲染函数
    slotsRender(h, render, context, renderArgs) {
      return render && render.call(this, h, context, renderArgs);
    },

    /**
     * 装饰数据行
     * @param {any} row
     */
    decorateRow(row, presetRowStates) {
      presetRowStates = presetRowStates || this.cPresetRowStates;

      return {
        ...row,
        $state: {
          ...presetRowStates,
        },
        children:
          row.children && row.children.length
            ? row.children.map((i) => this.decorateRow(i))
            : [],
      };
    },

    /**
     * 装饰表格数据
     * @param {array} rows 源数据
     */
    decorateData(rows, presetRowStates) {
      return rows.map((row) => {
        return this.decorateRow(row, presetRowStates);
      });
    },

    rowClassName({ row, rowIndex }) {
      let classes = [];

      if (this.selectedRows.indexOf(row) >= 0) {
        classes.push("is--selected");
      }

      return [classes];
    },

    test(str) {
      alert(str);
    },
  },

  async mounted() {
    this.ready = true;

    if (this.needRequest) {
      await this.getData();
    }
  },
};
</script>

<style lang="scss" src="./style.scss"></style>